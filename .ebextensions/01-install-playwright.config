packages:
  yum:
    wget: []
    unzip: []
    libX11: []
    libXcomposite: []
    libXcursor: []
    libXdamage: []
    libXext: []
    libXi: []
    libXrandr: []
    libXrender: []
    libXss: []
    libXtst: []
    libdrm: []
    libxshmfence: []
    cups-libs: []
    dbus-glib: []
    pango: []
    atk: []
    alsa-lib: []
    gtk3: []
    nss: []
    libnotify: []

files:
  "/tmp/install_playwright.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      echo "Installing Playwright dependencies..."
      
      # Install .NET SDK
      rpm -Uvh https://packages.microsoft.com/config/centos/7/packages-microsoft-prod.rpm
      yum -y install dotnet-sdk-7.0
      
      # Install Playwright
      export DOTNET_ROOT=/usr/local/dotnet
      mkdir -p $DOTNET_ROOT
      
      echo "Installing Playwright CLI tool..."
      dotnet tool install --global Microsoft.Playwright.CLI
      
      echo "Installing Playwright browsers..."
      export PATH="$PATH:$HOME/.dotnet/tools"
      playwright install
      playwright install-deps
      
      echo "Setting permissions..."
      chmod -R 755 ~/.cache/ms-playwright
      chmod -R 755 /root/.cache/ms-playwright
      
      echo "Playwright installation completed"
      
      # Create symlink to ensure app can find browsers
      mkdir -p /var/app/current/bin/Release/net7.0/linux-x64/
      ln -s /root/.cache/ms-playwright /var/app/current/bin/Release/net7.0/linux-x64/

commands:
  01_run_playwright_install:
    command: "/tmp/install_playwright.sh"
    ignoreErrors: false